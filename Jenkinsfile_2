properties([parameters([string(defaultValue: '1.0.0', name: 'image_tag')])])

podTemplate(label: 'demo-customer-pod', cloud: 'kubernetes', serviceAccount: 'jenkins',
  containers: [
    containerTemplate(name: "kaniko", image:"gcr.io/kaniko-project/executor:debug",  ttyEnabled: true, command: "/busybox/cat"),
  ]) {
    node('demo-customer-pod') {
        stage('Checkout') {
              git branch: 'main', url: 'https://github.com/alezander86/python_app_10760.git'
        }
        stage('Build with Kaniko') {
            container(name: 'kaniko', shell: '/busybox/sh') {
                sh '''#!/busybox/sh
                  echo "FROM jenkins/inbound-agent:latest" > Dockerfile
                  /kaniko/executor --context `pwd` --destination alezander/python_app:latest --destination alezander/python_app:${image_tag}
                '''
            }        
        }
        stage('test') {
//                container(name: 'helm'){
                    sh 'ls -la'
//                }    
        }
    }
}
